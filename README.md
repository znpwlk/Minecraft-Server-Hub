# Minecraft Server Hub (MSH) - 文档

## 项目简介

Minecraft Server Hub (MSH) 是一个基于 Java 开发的 Minecraft 服务器管理工具。该工具采用模块化架构设计，提供高效的服务器进程管理和监控功能。

### 技术架构特点

- **Java 8+ 核心**: 基于现代 Java 技术栈，稳定性高
- **Swing 图形界面**: 轻量级跨平台 GUI 框架
- **多线程设计**: 独立的进程监控和日志处理线程
- **模块化架构**: 清晰的功能模块分离，易于维护扩展
- **内存安全**: 完善的异常处理和资源管理
- **配置持久化**: Properties 格式配置文件，自动保存恢复

## 核心功能模块

### 主控制中心

**主要功能:**
- **图形界面管理**: 提供直观的标签页式界面，同时管理多个服务器
- **服务器添加**: 一键添加服务器，自动检测和验证服务器文件
- **程序状态管理**: 智能的程序关闭流程，确保所有服务器安全停止
- **配置持久化**: 自动保存用户的服务器配置和偏好设置
- **错误恢复**: 程序崩溃后能恢复到之前的工作状态

**用户体验:**
- 启动时自动加载上次使用的服务器
- 优雅关闭提示，避免意外关闭正在运行的服务器
- 简洁的按钮布局，操作直观易懂

### 服务器进程控制

**主要功能:**
- **一键启动/停止**: 简单按钮操作启动或停止Minecraft服务器
- **实时状态监控**: 显示服务器运行状态（运行中、已停止、启动中）
- **进程守护服务**: 服务器意外崩溃时自动重启，保证服务连续性
- **命令控制台**: 直接向服务器发送命令，支持快速命令选择
- **多实例支持**: 同时管理多个不同版本的Minecraft服务器

**智能特性:**
- 自动检测服务器文件变化
- 防止重复添加同一服务器
- 智能重启策略，避免频繁重启造成资源浪费

### 彩色日志显示

**主要功能:**
- **实时日志显示**: 实时显示服务器控制台输出，无需切换窗口
- **彩色消息区分**: 不同类型消息使用不同颜色显示（信息、警告、错误）
- **自动滚动**: 新日志自动滚动到可视区域
- **日志清空**: 一键清空历史日志，保持界面整洁
- **格式化显示**: 自动格式化服务器输出，提高可读性

**显示优势:**
- 重要错误信息用红色突出显示
- 玩家聊天信息用特殊颜色区分
- 支持大量日志输出不卡顿

### 配置管理

**主要功能:**
- **图形化配置编辑**: 通过表格界面编辑服务器配置文件
- **多数据类型支持**: 支持布尔值、数字、字符串等多种配置项
- **实时验证**: 配置修改时即时检查有效性，防止错误配置
- **配置备份**: 自动备份配置文件，避免配置丢失
- **批量操作**: 支持批量修改多个配置项

**管理功能:**
- 支持常见的服务器配置文件格式
- 提供配置项说明和默认值
- 导入/导出配置功能

### 程序日志系统

**主要功能:**
- **分级日志记录**: 按重要性分类记录程序运行信息
- **实时日志显示**: 在程序界面直接显示日志信息
- **日志文件保存**: 将重要日志保存到文件，便于问题排查
- **性能监控**: 记录程序性能指标，帮助优化运行效率

**日志级别:**
- INFO: 一般信息，记录程序正常运行状态
- WARN: 警告信息，提示需要注意的问题
- ERROR: 错误信息，记录影响功能的问题

### 输出流处理

**主要功能:**
- **实时输出捕获**: 捕获服务器的标准输出和错误输出
- **字符编码处理**: 自动处理不同编码格式，避免乱码问题
- **输出缓冲优化**: 智能缓冲机制，提升显示性能
- **异常恢复**: 网络或系统异常时自动恢复输出捕获

**处理优势:**
- 支持中文服务器消息正常显示
- 大批量日志输出时保持流畅
- 自动检测并处理输出流中断

## 高级功能特性

### 进程守护服务

**智能重启机制:**
- **自动检测**: 实时监控服务器进程状态，检测异常终止
- **安全重启**: 服务器意外停止时自动重启，保证服务连续性
- **重启限制**: 防止无限重启的安全机制，可设置最大重启次数
- **重启间隔**: 可配置重启等待时间，避免频繁重启
- **状态显示**: 清楚显示当前重启次数和状态

**配置选项:**
- 启用/禁用进程守护功能
- 设置最大重启尝试次数（1-10次）
- 调整重启间隔时间（5-300秒）

### 彩色日志系统

**智能显示:**
- **类型识别**: 自动识别不同类型的服务器消息
- **颜色编码**: 不同消息类型使用不同颜色显示
- **重要标记**: 错误和警告信息用醒目颜色突出
- **实时更新**: 新消息立即显示，无需手动刷新
- **历史管理**: 可清空历史日志，保持界面整洁

**显示分类:**
- 正常服务器信息（白色）
- 玩家聊天信息（绿色）
- 系统警告信息（黄色）
- 错误信息（红色）

### 配置管理工具

**可视化编辑:**
- **表格界面**: 直观的表格形式编辑配置文件
- **类型支持**: 支持布尔值、整数、字符串等多种数据类型
- **即时验证**: 修改配置时实时检查有效性
- **默认值**: 提供配置项的说明和默认值参考
- **批量操作**: 可同时修改多个相关配置项

**管理功能:**
- 自动备份当前配置
- 导入外部配置文件
- 导出当前配置为文件

### 多服务器管理

**并行管理:**
- **标签页界面**: 每个服务器占用独立的标签页
- **状态独立**: 各服务器状态相互独立，互不影响
- **统一控制**: 通过主界面统一管理所有服务器
- **资源监控**: 实时监控每个服务器的运行状态

**管理优势:**
- 同时运行多个不同版本的Minecraft服务器
- 统一的日志查看界面
- 一键停止所有服务器的安全机制

### 用户体验优化

**便捷操作:**
- **快速命令**: 下拉菜单提供常用命令快速选择
- **键盘支持**: 支持回车键快速发送命令
- **窗口提示**: 智能提示程序状态和操作建议
- **状态显示**: 实时显示当前程序和服务器状态

**界面友好:**
- 简洁直观的操作界面
- 重要操作前的确认提示
- 清晰的图标和按钮设计

## 故障排除

### 常见问题

**Q: 程序无法启动**
A: 检查 Java 版本是否为 8 或更高版本，确保有足够的内存可用。

**Q: 无法添加服务器**
A: 确保选择的文件是有效的 jar 文件，且程序有读取权限。

**Q: 服务器启动失败**
A: 检查服务器 jar 文件是否损坏，确保服务器配置正确。

**Q: 进程守护不工作**
A: 确认已在进程守护设置中启用该功能，并检查最大重启次数设置。

**Q: 日志显示异常**
A: 尝试清空日志显示，或重启程序。

### 错误代码说明

- `CRITICAL`: 严重错误，可能导致程序崩溃
- `ERROR`: 一般错误，功能可能受到影响
- `WARN`: 警告信息，提示潜在问题
- `INFO`: 一般信息，正常运行状态

## 开发信息

### 技术架构

- **编程语言**: Java 8+
- **图形界面**: Java Swing
- **构建工具**: Maven
- **主要依赖**:
  - Jansi (彩色终端输出)
  - Gson (JSON 处理)

### 项目结构

```
src/main/java/
├── Main.java              # 主程序入口和 GUI
├── JarRunner.java         # 服务器进程管理
├── ColorOutputPanel.java  # 彩色日志显示面板
├── ConfigManager.java     # 配置管理
├── ConfigEditor.java      # 配置编辑器
├── Logger.java            # 日志系统
└── OutputHandler.java     # 输出处理
```

### 编译构建

使用 Maven 进行项目构建：

```bash
mvn clean package
```

生成的 jar 文件位置：`target/mc-server-hub-1.0.2.jar`

## 版本信息

- **当前版本**: 1.0.2
- **作者**: znpwlk

## 支持与反馈

如遇到问题或有功能建议，请通过以下方式联系：

- GitHub Issues: 提交问题报告
- 项目主页: 获取最新版本和文档

## 许可证

本项目采用开源许可证，详情请查看项目仓库中的 LICENSE 文件。

---

*最后更新: 2025年12月21日*
