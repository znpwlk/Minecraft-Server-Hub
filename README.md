# Minecraft Server Hub (MSH) - 文档

## 项目简介

Minecraft Server Hub (MSH) 是一个基于 Java 21 开发的 Minecraft 服务器管理工具。该工具采用模块化架构设计，提供高效的服务器进程管理和监控功能。

### 技术架构特点

Java 21 核心：基于现代 Java 技术栈，稳定性高
Swing 图形界面：轻量级跨平台 GUI 框架
多线程设计：独立的进程监控和日志处理线程
模块化架构：清晰的功能模块分离，易于维护扩展
内存安全：完善的异常处理和资源管理
配置持久化：Properties 格式配置文件，自动保存恢复

## 核心功能模块

### Main.java - 主控制中心

主要功能：
图形界面管理：提供直观的标签页式界面，同时管理多个服务器
服务器添加：一键添加服务器，自动检测和验证服务器文件
程序状态管理：智能的程序关闭流程，确保所有服务器安全停止
配置持久化：自动保存用户的服务器配置和偏好设置
错误恢复：程序崩溃后能恢复到之前的工作状态

用户体验：
启动时自动加载上次使用的服务器
优雅关闭提示，避免意外关闭正在运行的服务器
简洁的按钮布局，操作直观易懂

### JarRunner.java - 服务器进程控制

主要功能：
一键启动/停止：简单按钮操作启动或停止Minecraft服务器
实时状态监控：显示服务器运行状态（运行中、已停止、启动中）
进程守护服务：服务器意外崩溃时自动重启，保证服务连续性
命令控制台：直接向服务器发送命令，支持快速命令选择
多实例支持：同时管理多个不同版本的Minecraft服务器

智能特性：
自动检测服务器文件变化
防止重复添加同一服务器
智能重启策略，避免频繁重启造成资源浪费

### ColorOutputPanel.java - 彩色日志显示

主要功能：
实时日志显示：实时显示服务器控制台输出，无需切换窗口
彩色消息区分：不同类型消息使用不同颜色显示（信息、警告、错误）
自动滚动：新日志自动滚动到可视区域
日志清空：一键清空历史日志，保持界面整洁
格式化显示：自动格式化服务器输出，提高可读性

显示优势：
重要错误信息用红色突出显示
玩家聊天信息用特殊颜色区分
支持大量日志输出不卡顿

### ConfigManager.java & ConfigEditor.java - 配置管理

主要功能：
图形化配置编辑：通过表格界面编辑服务器配置文件
多数据类型支持：支持布尔值、数字、字符串等多种配置项
实时验证：配置修改时即时检查有效性，防止错误配置
配置备份：自动备份配置文件，避免配置丢失
批量操作：支持批量修改多个配置项

管理功能：
支持常见的服务器配置文件格式
提供配置项说明和默认值
导入/导出配置功能

### Logger.java - 程序日志系统

主要功能：
分级日志记录：按重要性分类记录程序运行信息
实时日志显示：在程序界面直接显示日志信息
日志文件保存：将重要日志保存到文件，便于问题排查
性能监控：记录程序性能指标，帮助优化运行效率

日志级别：
INFO：一般信息，记录程序正常运行状态
WARN：警告信息，提示需要注意的问题
ERROR：错误信息，记录影响功能的问题

### ConfigManager.java & ConfigEditor.java - 配置管理

**主要功能:**
- **图形化配置编辑**: 通过表格界面编辑服务器配置文件
- **多数据类型支持**: 支持布尔值、数字、字符串等多种配置项
- **实时验证**: 配置修改时即时检查有效性，防止错误配置
- **配置备份**: 自动备份配置文件，避免配置丢失
- **批量操作**: 支持批量修改多个配置项

**管理功能:**
- 支持常见的服务器配置文件格式
- 提供配置项说明和默认值
- 导入/导出配置功能

### Logger.java - 程序日志系统

**主要功能:**
- **分级日志记录**: 按重要性分类记录程序运行信息
- **实时日志显示**: 在程序界面直接显示日志信息
- **日志文件保存**: 将重要日志保存到文件，便于问题排查
- **性能监控**: 记录程序性能指标，帮助优化运行效率

**日志级别:**
- INFO: 一般信息，记录程序正常运行状态
- WARN: 警告信息，提示需要注意的问题
- ERROR: 错误信息，记录影响功能的问题

### OutputHandler.java - 输出流处理

主要功能：
实时输出捕获：捕获服务器的标准输出和错误输出
字符编码处理：自动处理不同编码格式，避免乱码问题
输出缓冲优化：智能缓冲机制，提升显示性能
异常恢复：网络或系统异常时自动恢复输出捕获

处理优势：
支持中文服务器消息正常显示
大批量日志输出时保持流畅
自动检测并处理输出流中断

### PreferenceManager.java - 用户偏好设置

主要功能：
配置持久化：自动保存和加载用户偏好设置
更新检查设置：控制是否自动检查软件更新
智能默认值：对于未配置的选项提供合理的默认值
独立存储：将偏好设置与服务器配置分离

配置项：
更新检查开关（默认启用）
上次更新检查时间记录
配置存储位置：MSH/preferences.properties

### UpdateManager.java - 软件更新管理

主要功能：
自动更新检查：启动时自动检查最新版本
版本对比：与远程版本库进行智能对比
更新下载：提供安全的下载链接和SHA256校验
强制更新：支持紧急安全更新的强制更新机制
更新说明：显示详细的更新内容和变更日志

智能特性：
后台静默检查，不阻塞程序启动
用户可选择关闭自动更新检查
下载前进行文件完整性验证
支持多个更新服务器地址

显示信息：
当前版本号和最新版本号
更新发布日期
更新内容摘要
下载进度和状态

### AddressDialog.java - 服务器地址管理

主要功能：
地址自动检测：自动获取服务器所有可用地址
本地地址显示：显示本地回环地址 127.0.0.1
内网地址检测：自动检测并显示内网IP地址
公网地址获取：支持获取并显示公网IP地址
一键复制：点击按钮即可复制地址到剪贴板

智能显示：
本地回环地址（绿色高亮）
内网地址（绿色高亮）
公网地址（红色高亮，默认隐藏，需同意免责声明）
端口信息自动附加

安全特性：
公网地址默认隐藏，防止误操作暴露
强制显示需经过多重确认
完整的风险提示和安全建议
支持只复制IP或完整地址

### NetworkUtils.java - 网络工具集

主要功能：
IP自动获取：自动检测服务器可用IP地址
多地址支持：同时获取本地、内网、公网地址
端口检测：检测指定端口是否开放
异步获取：公网IP获取不阻塞主界面
网络接口遍历：智能遍历所有网络接口

公网IP服务：
多个备选服务（ipify、icanhazip、ifconfig.me、checkip.amazonaws）
自动故障转移，单个服务不可用时自动切换
5秒超时设置，快速响应
IP格式验证，确保结果正确

网络地址分类：
本地回环地址：127.0.0.1
内网地址：自动检测局域网IP
公网地址：异步获取公网IP

### JsonGameRuleLoader.java - 游戏规则配置

主要功能：
规则索引加载：从远程服务器加载游戏规则索引
规则分类管理：按类别组织游戏规则
远程更新：规则定义可远程更新，无需重新编译程序
缓存机制：本地缓存规则数据，减少网络请求

支持的规则类型：
生存模式规则：keepInventory、mobGriefing、naturalRegeneration
实体规则：doMobSpawning、doTileDrops、maxEntityCramming
环境规则：doWeatherCycle、doDaylightCycle、fireSpreads、tntExplodes
爆炸规则：mobExplosionDropBlock
生物行为：zombieAggressiveTowardsVillagers、doWardenSpawning
数值规则：spawnRadius（生成半径）

### EncodingUtils.java - 编码工具

主要功能：
智能编码检测：自动检测并选择最佳字符编码
跨平台兼容：支持 Windows、Mac、Linux 系统
编码转换：提供安全的编码转换功能
乱码预防：自动处理不同编码格式，避免显示乱码

支持编码：
UTF-8（首选）
GBK、GB2312、GB18030
Big5
系统默认编码

## 高级功能特性

### 进程守护服务

**智能重启机制:**
- **自动检测**: 实时监控服务器进程状态，检测异常终止
- **安全重启**: 服务器意外停止时自动重启，保证服务连续性
- **重启限制**: 防止无限重启的安全机制，可设置最大重启次数
- **重启间隔**: 可配置重启等待时间，避免频繁重启
- **状态显示**: 清楚显示当前重启次数和状态

**配置选项:**
- 启用/禁用进程守护功能
- 设置最大重启尝试次数（1-10次）
- 调整重启间隔时间（5-300秒）

### 彩色日志系统

**智能显示:**
- **类型识别**: 自动识别不同类型的服务器消息
- **颜色编码**: 不同消息类型使用不同颜色显示
- **重要标记**: 错误和警告信息用醒目颜色突出
- **实时更新**: 新消息立即显示，无需手动刷新
- **历史管理**: 可清空历史日志，保持界面整洁

**显示分类:**
- 正常服务器信息（白色）
- 玩家聊天信息（绿色）
- 系统警告信息（黄色）
- 错误信息（红色）

### 配置管理工具

**可视化编辑:**
- **表格界面**: 直观的表格形式编辑配置文件
- **类型支持**: 支持布尔值、整数、字符串等多种数据类型
- **即时验证**: 修改配置时实时检查有效性
- **默认值**: 提供配置项的说明和默认值参考
- **批量操作**: 可同时修改多个相关配置项

**管理功能:**
- 自动备份当前配置
- 导入外部配置文件
- 导出当前配置为文件

### 多服务器管理

**并行管理:**
- **标签页界面**: 每个服务器占用独立的标签页
- **状态独立**: 各服务器状态相互独立，互不影响
- **统一控制**: 通过主界面统一管理所有服务器
- **资源监控**: 实时监控每个服务器的运行状态

**管理优势:**
- 同时运行多个不同版本的Minecraft服务器
- 统一的日志查看界面
- 一键停止所有服务器的安全机制

### 用户体验优化

**便捷操作:**
- **快速命令**: 下拉菜单提供常用命令快速选择
- **键盘支持**: 支持回车键快速发送命令
- **窗口提示**: 智能提示程序状态和操作建议
- **状态显示**: 实时显示当前程序和服务器状态

**界面友好:**
- 简洁直观的操作界面
- 重要操作前的确认提示
- 清晰的图标和按钮设计

## 故障排除

### 常见问题

**Q: 程序无法启动**
A: 检查 Java 版本是否为 21 或更高版本，确保有足够的内存可用。

**Q: 无法添加服务器**
A: 确保选择的文件是有效的 jar 文件，且程序有读取权限。

**Q: 服务器启动失败**
A: 检查服务器 jar 文件是否损坏，确保服务器配置正确。

**Q: 进程守护不工作**
A: 确认已在进程守护设置中启用该功能，并检查最大重启次数设置。

**Q: 日志显示异常**
A: 尝试清空日志显示，或重启程序。检查系统编码设置是否正确。

**Q: 找不到更新检查选项**
A: 在偏好设置中可以控制是否启用自动更新检查，默认是开启状态。

**Q: 公网地址不显示**
A: 公网地址默认隐藏以保护安全，需要同意免责声明后才能显示。

**Q: 游戏规则加载失败**
A: 检查网络连接，确保可以访问远程规则索引服务器。

**Q: 编码设置不生效**
A: 重启程序使编码设置生效，确保系统支持所选编码格式。

---

## 更新日志

### v1.1.1 新增功能

#### 日志导出功能

**主要功能:**
- **多格式导出**: 支持将日志导出为 TXT、CSV、HTML 三种格式
- **内容完整保留**: 导出日志包含时间戳、消息类型等完整信息
- **一键操作**: 界面提供导出按钮，快速保存当前日志
- **格式选择**: 根据需求选择最适合的格式进行分析和分享

**格式说明:**
- TXT: 纯文本格式，适合直接查看和打印
- CSV: 表格格式，适合在Excel等工具中分析
- HTML: 网页格式，带颜色标记和交互功能

#### 服务器地址管理

**主要功能:**
- **地址自动检测**: 自动获取服务器的所有可用地址
- **本地地址**: 显示本地回环地址 127.0.0.1
- **内网地址**: 自动检测并显示内网IP地址
- **公网地址**: 支持获取并显示公网IP地址
- **地址一键复制**: 点击按钮即可复制地址到剪贴板

**智能显示:**
- 本地回环地址（绿色背景）
- 内网地址（绿色背景）
- 公网地址（红色背景，默认隐藏，需同意免责声明）

**安全特性:**
- 公网地址默认隐藏，防止误操作暴露
- 强制显示需经过多重确认
- 完整的风险提示和安全建议

#### 游戏规则实时调整

**主要功能:**
- **可视化界面**: 图形化界面调整服务器游戏规则
- **实时生效**: 修改后立即应用到运行中的服务器
- **规则浏览**: 查看所有可调整的游戏规则及其说明
- **状态监控**: 实时显示当前规则值

**支持的规则:**
- 生存模式规则: keepInventory、mobGriefing、naturalRegeneration
- 实体规则: doMobSpawning、doTileDrops、maxEntityCramming
- 环境规则: doWeatherCycle、doDaylightCycle、fireSpreads、tntExplodes
- 爆炸规则: mobExplosionDropBlock
- 生物行为: zombieAggressiveTowardsVillagers、doWardenSpawning
- 数值规则: spawnRadius（生成半径）

**操作说明:**
- 布尔类型规则使用复选框
- 数值类型规则使用数字微调框
- 实时显示规则加载状态

#### 编码优化

**主要功能:**
- **智能编码检测**: 自动检测并选择最佳字符编码
- **跨平台兼容**: 支持 Windows、Mac、Linux 系统
- **编码转换**: 提供安全的编码转换功能
- **乱码预防**: 自动处理不同编码格式，避免显示乱码

**支持编码:**
- UTF-8（首选）
- GBK、GB2312、GB18030
- Big5

#### 网络工具

**主要功能:**
- **IP自动获取**: 自动检测服务器可用IP地址
- **多地址支持**: 同时获取本地、内网、公网地址
- **端口检测**: 检测指定端口是否开放
- **异步获取**: 公网IP获取不阻塞主界面

**公网IP服务:**
- 多个备选服务，确保获取成功
- 5秒超时设置，快速响应
- IP格式验证，确保结果正确

#### 端口配置向导

**主要功能:**
- **一键配置**: 快速配置公网访问
- **完整指导**: 提供详细的端口映射设置指南
- **防火墙提示**: 提醒并指导防火墙设置
- **风险确认**: 强制用户确认了解安全风险

**配置步骤:**
- 路由器端口映射设置指南
- 防火墙端口放行指导
- 多个服务地址测试
- 实时配置状态反馈

---

### 安全提示

**重要警告:**
- 公网访问存在安全风险，可能遭受黑客攻击
- 开放公网访问前请确保已采取必要安全措施
- 建议使用强密码并安装安全认证插件
- 定期备份服务器存档
- 监控服务器日志，排查异常活动

**推荐安全措施:**
- 安装玩家认证插件（如AuthMe）
- 定期更新服务器和插件版本
- 配置白名单限制可加入玩家
- 使用防火墙限制未知IP访问
